---
phase: 02-password-policy
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/auth/PasswordStrengthIndicator.tsx
  - src/components/auth/AuthForm.tsx
autonomous: false

must_haves:
  truths:
    - "User sees real-time strength bar (3 segments: red/yellow/green) below password field during signup"
    - "User sees real-time checklist of 4 requirements with check/cross icons on password field focus"
    - "User sees confirmation field only during signup mode"
    - "User sees real-time match/mismatch feedback below confirmation field in Hebrew"
    - "Submit button is disabled until all 4 rules pass AND confirmation matches during signup"
    - "Sign-in mode has no validation UI, no confirmation field, no submit gating"
  artifacts:
    - path: "src/components/auth/PasswordStrengthIndicator.tsx"
      provides: "Strength bar + validation checklist presentational component"
      min_lines: 40
      contains: "PasswordStrengthIndicator"
    - path: "src/components/auth/AuthForm.tsx"
      provides: "Modified signup form with password validation, confirmation, submit gating"
      contains: "validatePassword"
  key_links:
    - from: "src/components/auth/AuthForm.tsx"
      to: "src/lib/validation-patterns.ts"
      via: "import validatePassword, PASSWORD_REQUIREMENTS, PASSWORD_STRENGTH_LABELS, PASSWORD_CONFIRMATION_MESSAGES"
      pattern: "import.*validatePassword.*from.*validation-patterns"
    - from: "src/components/auth/AuthForm.tsx"
      to: "src/components/auth/PasswordStrengthIndicator.tsx"
      via: "import and render PasswordStrengthIndicator"
      pattern: "import.*PasswordStrengthIndicator"
    - from: "src/components/auth/AuthForm.tsx"
      to: "submit button disabled state"
      via: "isSubmitDisabled computed from validation.isValid and passwordsMatch"
      pattern: "disabled.*isSubmitDisabled|disabled.*validation"
---

<objective>
Build the password validation UI: PasswordStrengthIndicator component, validation checklist, confirmation field with match checking, and wire everything into AuthForm with submit gating.

Purpose: This delivers all user-facing password policy features (PWD-01 through PWD-06). The validation logic from Plan 01 is pure functions; this plan renders that logic as interactive UI with real-time feedback in Hebrew/RTL. After this plan, users see strength indicators, requirement checklists, and confirmation validation during signup.

Output: New PasswordStrengthIndicator.tsx component + modified AuthForm.tsx with full password validation UX.
</objective>

<execution_context>
@/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-password-policy/02-CONTEXT.md
@.planning/phases/02-password-policy/02-RESEARCH.md
@.planning/phases/02-password-policy/02-01-SUMMARY.md

# Source files
@src/components/auth/AuthForm.tsx
@src/lib/validation-patterns.ts
@src/lib/auth-errors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PasswordStrengthIndicator component with strength bar and validation checklist</name>
  <files>src/components/auth/PasswordStrengthIndicator.tsx</files>
  <action>
    Create a new presentational component at src/components/auth/PasswordStrengthIndicator.tsx that renders two sections:

    **Section 1: Segmented Strength Bar**
    - 3 horizontal segments in a flex row with small gap
    - Each segment is a rounded div with height ~2 (h-2)
    - Segments fill based on strength: weak=1 segment, medium=2 segments, strong=3 segments
    - Colors: weak=red-500, medium=yellow-500, strong=green-500. Unfilled segments use bg-muted.
    - Add `transition-colors` class for smooth color transitions
    - Hebrew strength label displayed next to or below the bar: "חלשה" / "בינונית" / "חזקה"
    - Import labels from PASSWORD_STRENGTH_LABELS in validation-patterns.ts

    **Section 2: Requirements Checklist**
    - Only shown when `showChecklist` prop is true
    - 4 items, each showing a lucide-react icon + Hebrew label:
      - Check icon (green) when rule passes, CircleX icon (red) when rule fails
      - Icons: size w-4 h-4
      - Hebrew labels from PASSWORD_REQUIREMENTS in validation-patterns.ts
    - List items use flex layout with gap-2 for icon+text alignment
    - Container has dir="rtl" for correct Hebrew layout

    **Props interface:**
    ```typescript
    interface PasswordStrengthIndicatorProps {
      validation: {
        hasMinLength: boolean;
        hasUppercase: boolean;
        hasLowercase: boolean;
        hasNumber: boolean;
        score: number;
        strength: 'weak' | 'medium' | 'strong';
      };
      showChecklist: boolean;
    }
    ```

    **Accessibility:**
    - Add `aria-live="polite"` on the checklist container so screen readers announce changes
    - Add `role="status"` on the strength label
    - Each checklist item text changes (not just icon color) so screen readers detect updates

    **DO NOT:**
    - Use inline Hebrew strings -- import from validation-patterns.ts
    - Add complex animations beyond transition-colors
    - Make this component manage any state (pure presentational, all data via props)
  </action>
  <verify>
    - File exists at src/components/auth/PasswordStrengthIndicator.tsx
    - `npx tsc --noEmit` compiles clean
    - Component exports PasswordStrengthIndicator as named export
    - Imports Check, CircleX from lucide-react
    - Imports PASSWORD_REQUIREMENTS, PASSWORD_STRENGTH_LABELS from @/lib/validation-patterns
    - Has aria-live="polite" and role="status" attributes
  </verify>
  <done>
    PasswordStrengthIndicator component exists with strength bar (3 segments, red/yellow/green), checklist (4 items with Check/CircleX icons and Hebrew labels), and accessibility attributes. Pure presentational, no internal state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate password validation, confirmation field, and submit gating into AuthForm</name>
  <files>src/components/auth/AuthForm.tsx</files>
  <action>
    Modify AuthForm.tsx to add password validation UI for signup mode. Sign-in mode must remain completely unchanged.

    **New imports to add:**
    - `useMemo` from react (add to existing useState import)
    - `Check` from lucide-react (add to existing Building2, Loader2 import)
    - `validatePassword, PASSWORD_CONFIRMATION_MESSAGES` from @/lib/validation-patterns
    - `PasswordStrengthIndicator` from ./PasswordStrengthIndicator

    **New state variables (add after existing state):**
    - `const [confirmPassword, setConfirmPassword] = useState('');`
    - `const [showChecklist, setShowChecklist] = useState(false);`

    **Computed validation (useMemo, add after state declarations):**
    ```typescript
    const validation = useMemo(() => {
      if (mode === 'signin') return null;
      return validatePassword(password);
    }, [mode, password]);

    const passwordsMatch = useMemo(() => {
      if (mode === 'signin' || confirmPassword === '') return null;
      return password === confirmPassword;
    }, [mode, password, confirmPassword]);
    ```

    **Submit button disabled logic:**
    ```typescript
    const isSubmitDisabled =
      loading ||
      (mode === 'signup' && (
        !validation?.isValid ||
        passwordsMatch !== true
      ));
    ```
    Note: `passwordsMatch !== true` handles both `false` (mismatch) and `null` (empty confirmation).

    **Modify password input section** (the existing div.space-y-2 containing password Label+Input):
    - Add `onFocus={() => mode === 'signup' && setShowChecklist(true)}` to the existing password Input
    - After the password Input, add (inside the same space-y-2 div):
      - Conditional render: `{mode === 'signup' && validation && ( <PasswordStrengthIndicator validation={validation} showChecklist={showChecklist} /> )}`

    **Add confirmation field** (new div.space-y-2 block AFTER the password section, BEFORE the submit button):
    - Only render when `mode === 'signup'`
    - Label: "אימות סיסמה" with htmlFor="confirmPassword"
    - Input: id="confirmPassword", type="password", placeholder="••••••••", value={confirmPassword}, onChange updates state, required, dir="ltr", className="text-left"
    - Below Input, conditional match feedback (only when confirmPassword is non-empty):
      - Match (passwordsMatch === true): green text with Check icon + PASSWORD_CONFIRMATION_MESSAGES.match
      - No match (passwordsMatch === false): red text with PASSWORD_CONFIRMATION_MESSAGES.noMatch
    - Match feedback container: dir="rtl", role="status", text-sm

    **Update submit Button:**
    - Change `disabled={loading}` to `disabled={isSubmitDisabled}`

    **Reset state on mode switch:**
    - In the mode toggle button onClick, add: `setConfirmPassword(''); setShowChecklist(false);`
    - This prevents stale confirmation/checklist state when switching between signin/signup

    **DO NOT:**
    - Change any sign-in mode behavior (no validation, no confirmation field, no submit gating)
    - Remove existing imports or break existing error handling
    - Add console.log for passwords
    - Change the form's onSubmit handler logic (handleSubmit stays the same)
    - Remove the existing minLength={8} HTML attribute on the password input (keep as fallback)
  </action>
  <verify>
    - `npx tsc --noEmit` compiles clean
    - `npx vitest run` -- full test suite passes (no regressions)
    - `npm run build` -- production build succeeds
    - AuthForm.tsx imports validatePassword from @/lib/validation-patterns
    - AuthForm.tsx imports PasswordStrengthIndicator from ./PasswordStrengthIndicator
    - AuthForm.tsx has useMemo for validation and passwordsMatch
    - Submit button uses isSubmitDisabled
    - Confirmation field renders only in signup mode
    - Mode switch resets confirmPassword and showChecklist
  </verify>
  <done>
    AuthForm shows password strength indicator + requirement checklist + confirmation field in signup mode. Submit is disabled until all 4 rules pass and confirmation matches. Sign-in mode is completely unaffected. All existing tests pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete password policy implementation:
    1. Password validation logic with 4 rules (8+ chars, uppercase, lowercase, number)
    2. Visual strength indicator (3-segment bar: red/yellow/green with Hebrew labels)
    3. Real-time requirements checklist with check/cross icons
    4. Password confirmation field with Hebrew match/mismatch feedback
    5. Submit button gating (disabled until all rules pass + confirmation matches)
    All in Hebrew/RTL layout, signup mode only.
  </what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev`
    2. Navigate to the auth page
    3. Switch to signup mode (click "הירשם עכשיו")
    4. Click on the password field -- verify the requirements checklist appears
    5. Type "abc" -- verify:
       - Strength bar shows 1 red segment (weak / חלשה)
       - Checklist: lowercase has green check, other 3 have red X
    6. Type "Abc" -- verify uppercase check turns green (2 rules, still weak)
    7. Type "Abcdefg1" -- verify:
       - All 4 checklist items show green checks
       - Strength bar shows 3 green segments (strong / חזקה)
    8. In confirmation field, type "Abcdefg2" -- verify red "הסיסמאות אינן תואמות" message
    9. Change confirmation to "Abcdefg1" -- verify green checkmark with "הסיסמאות תואמות"
    10. Verify submit button is now enabled
    11. Switch to sign-in mode (click "התחבר") -- verify NO strength indicator, NO checklist, NO confirmation field
    12. Verify sign-in submit button is NOT disabled by password validation
    13. Check RTL alignment -- Hebrew text should be right-aligned, icons on the correct side
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues with the password validation UI</resume-signal>
</task>

</tasks>

<verification>
1. `npx vitest run` -- full test suite passes (442+ tests, zero regressions)
2. `npx tsc --noEmit` -- TypeScript compiles clean
3. `npm run build` -- production build succeeds
4. Manual testing confirms all 6 PWD requirements:
   - PWD-01: Cannot submit with < 8 characters (submit disabled)
   - PWD-02: Uppercase required (checklist + submit gate)
   - PWD-03: Lowercase required (checklist + submit gate)
   - PWD-04: Number required (checklist + submit gate)
   - PWD-05: Strength indicator visible with 3 segments + Hebrew label
   - PWD-06: Confirmation field with real-time match checking
5. Sign-in mode completely unaffected
</verification>

<success_criteria>
- PasswordStrengthIndicator.tsx exists as standalone component with strength bar + checklist
- AuthForm.tsx integrates validation, confirmation, and submit gating for signup mode only
- All Hebrew labels match CONTEXT.md: חלשה / בינונית / חזקה, checklist items, confirmation messages
- Submit disabled until validation.isValid === true AND passwordsMatch === true
- Sign-in mode has zero password validation UI or gating
- All tests pass, TypeScript clean, build succeeds
- User visually confirms the UI works correctly (checkpoint)
</success_criteria>

<output>
After completion, create `.planning/phases/02-password-policy/02-02-SUMMARY.md`
</output>
