---
phase: 02-password-policy
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/lib/validation-patterns.ts
  - src/lib/validation-patterns.test.ts
autonomous: true

must_haves:
  truths:
    - "validatePassword returns correct boolean for each of the 4 rules"
    - "validatePassword score equals count of passing rules (0-4)"
    - "validatePassword isValid is true only when all 4 rules pass"
    - "Strength maps correctly: 1-2 rules = weak, 3 rules = medium, 4 rules = strong"
  artifacts:
    - path: "src/lib/validation-patterns.ts"
      provides: "Password validation function and regex constants"
      exports: ["validatePassword", "PASSWORD_MIN_LENGTH", "PASSWORD_HAS_UPPERCASE", "PASSWORD_HAS_LOWERCASE", "PASSWORD_HAS_NUMBER", "PASSWORD_STRONG"]
      contains: "validatePassword"
    - path: "src/lib/validation-patterns.test.ts"
      provides: "Comprehensive tests for password validation"
      min_lines: 60
  key_links:
    - from: "src/lib/validation-patterns.ts"
      to: "validatePassword return type"
      via: "TypeScript interface"
      pattern: "hasMinLength.*hasUppercase.*hasLowercase.*hasNumber.*score.*isValid"
---

<objective>
TDD implementation of password validation logic with comprehensive test coverage.

Purpose: Create the core validation engine that powers all password policy features (PWD-01 through PWD-04 requirement checking, PWD-05 strength scoring). This is pure business logic with defined inputs/outputs -- ideal for TDD. Getting validation right here means the UI layer (Plan 02) just renders results.

Output: `validatePassword()` function exported from `validation-patterns.ts` with co-located test file. Covers all 4 password requirements + strength scoring + isValid gate.
</objective>

<execution_context>
@/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-password-policy/02-CONTEXT.md
@.planning/phases/02-password-policy/02-RESEARCH.md

# Source files to modify/reference
@src/lib/validation-patterns.ts
@src/lib/auth-errors.ts
@.planning/codebase/TESTING.md
@.planning/codebase/CONVENTIONS.md
</context>

<feature>
  <name>Password Validation Logic</name>
  <files>src/lib/validation-patterns.ts, src/lib/validation-patterns.test.ts</files>
  <behavior>
    validatePassword(password: string) returns object with:
    - hasMinLength: boolean (password.length >= 8)
    - hasUppercase: boolean (/[A-Z]/ test)
    - hasLowercase: boolean (/[a-z]/ test)
    - hasNumber: boolean (/\d/ test)
    - score: number (count of true rules, 0-4)
    - strength: 'weak' | 'medium' | 'strong' (1-2=weak, 3=medium, 4=strong)
    - isValid: boolean (score === 4)

    Test cases (input -> expected):
    - "" -> all false, score 0, weak, invalid
    - "abc" -> hasLowercase true only, score 1, weak, invalid
    - "abcdefgh" -> hasMinLength + hasLowercase, score 2, weak, invalid
    - "Abcdefgh" -> hasMinLength + hasUppercase + hasLowercase, score 3, medium, invalid
    - "Abcdefg1" -> all true, score 4, strong, valid
    - "AB12" -> hasUppercase + hasNumber, score 2, weak, invalid (too short)
    - "abcdefg1" -> hasMinLength + hasLowercase + hasNumber, score 3, medium, invalid
    - "ABCDEFG1" -> hasMinLength + hasUppercase + hasNumber, score 3, medium, invalid
    - "Abcdefgh1" -> all true, score 4, strong, valid
    - "12345678" -> hasMinLength + hasNumber, score 2, weak, invalid

    Also export constants:
    - PASSWORD_MIN_LENGTH = 8
    - PASSWORD_HAS_UPPERCASE = /[A-Z]/
    - PASSWORD_HAS_LOWERCASE = /[a-z]/
    - PASSWORD_HAS_NUMBER = /\d/
    - PASSWORD_STRONG = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/

    Also export Hebrew label constants for UI consumption:
    - PASSWORD_REQUIREMENTS: object mapping rule keys to Hebrew labels
    - PASSWORD_STRENGTH_LABELS: object mapping strength to Hebrew labels
    - PASSWORD_CONFIRMATION_MESSAGES: object with match/noMatch Hebrew strings
  </behavior>
  <implementation>
    RED phase:
    1. Create src/lib/validation-patterns.test.ts
    2. Import validatePassword (does not exist yet -- will fail)
    3. Write tests for all 10+ test cases above covering:
       - Empty string edge case
       - Individual rules (only lowercase, only uppercase, only number, only length)
       - Combinations (2 rules, 3 rules, all 4 rules)
       - Score counting accuracy
       - Strength mapping (weak/medium/strong boundaries)
       - isValid gate (only true when score === 4)
       - Exported constants exist and have correct values
       - Hebrew label exports exist with correct strings
    4. Run: npx vitest run src/lib/validation-patterns.test.ts -- must FAIL
    5. Commit: test(02-01): add failing tests for password validation

    GREEN phase:
    1. Add to existing src/lib/validation-patterns.ts (DO NOT remove existing domain/slug exports):
       - PASSWORD_MIN_LENGTH constant
       - PASSWORD_HAS_UPPERCASE, PASSWORD_HAS_LOWERCASE, PASSWORD_HAS_NUMBER regex constants
       - PASSWORD_STRONG combined regex
       - validatePassword() function
       - PASSWORD_REQUIREMENTS Hebrew labels object
       - PASSWORD_STRENGTH_LABELS Hebrew labels object
       - PASSWORD_CONFIRMATION_MESSAGES Hebrew labels object
    2. Implementation follows RESEARCH.md code example exactly
    3. ASCII characters only assumption -- document in JSDoc comment
    4. Run: npx vitest run src/lib/validation-patterns.test.ts -- must PASS
    5. Also run: npx vitest run src/lib/ -- ensure existing validation-patterns tests (if any) still pass
    6. Commit: feat(02-01): implement password validation logic

    REFACTOR phase (if needed):
    1. Check if function can be cleaner (unlikely -- it's straightforward)
    2. Run tests to confirm still passing
    3. Commit only if changes made
  </implementation>
</feature>

<verification>
- `npx vitest run src/lib/validation-patterns.test.ts` -- all tests pass
- `npx vitest run` -- full test suite passes (no regressions)
- `npx tsc --noEmit` -- TypeScript compiles clean
- validatePassword exported and importable from @/lib/validation-patterns
- Hebrew label constants exported and accessible
- Existing domain/slug validation functions unchanged
</verification>

<success_criteria>
- All password validation tests pass (10+ test cases)
- validatePassword("Abcdefg1") returns { hasMinLength: true, hasUppercase: true, hasLowercase: true, hasNumber: true, score: 4, strength: 'strong', isValid: true }
- validatePassword("abc") returns { hasMinLength: false, hasUppercase: false, hasLowercase: true, hasNumber: false, score: 1, strength: 'weak', isValid: false }
- Full test suite passes with zero regressions
- TypeScript compiles clean
- Hebrew labels match CONTEXT.md specifications exactly
</success_criteria>

<output>
After completion, create `.planning/phases/02-password-policy/02-01-SUMMARY.md`
</output>
