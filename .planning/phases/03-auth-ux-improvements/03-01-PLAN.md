---
phase: 03-auth-ux-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/auth/AuthForm.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle password visibility on main password field via Eye/EyeOff icon button"
    - "User can toggle password visibility on confirmation field (signup mode) via separate Eye/EyeOff icon button"
    - "All form fields have correct HTML5 autocomplete attributes for password manager compatibility"
    - "Switching between signin and signup mode clears all form fields and resets visibility toggles"
  artifacts:
    - path: "src/components/auth/AuthForm.tsx"
      provides: "Password toggle, autocomplete attributes, form clearing on mode switch"
      contains: "showPassword"
  key_links:
    - from: "src/components/auth/AuthForm.tsx"
      to: "lucide-react"
      via: "import Eye, EyeOff"
      pattern: "import.*Eye.*EyeOff.*from.*lucide-react"
    - from: "src/components/auth/AuthForm.tsx"
      to: "password input type"
      via: "showPassword state toggles type between password and text"
      pattern: "type=.*showPassword.*password.*text"
---

<objective>
Add password visibility toggles, autocomplete attributes, and form clearing on mode switch to AuthForm.

Purpose: Users need to verify what they typed in password fields (especially on mobile), password managers need correct autocomplete hints to save/fill credentials, and switching modes should not carry stale data between signin and signup forms.

Output: Modified AuthForm.tsx with Eye/EyeOff toggle buttons on all password fields, HTML5 autocomplete attributes on every input, and a useEffect that clears form state when mode changes.
</objective>

<execution_context>
@/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-auth-ux-improvements/03-RESEARCH.md

# Source files
@src/components/auth/AuthForm.tsx
@src/lib/auth-errors.ts
@src/lib/validation-patterns.ts

# Must reference Phase 02 summary - this plan runs AFTER Phase 02
@.planning/phases/02-password-policy/02-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add password visibility toggles to all password fields in AuthForm</name>
  <files>src/components/auth/AuthForm.tsx</files>
  <action>
    Modify AuthForm.tsx to add Eye/EyeOff toggle buttons to password fields. Phase 02 will have already modified this file to include confirmPassword state and PasswordStrengthIndicator.

    **New imports to add:**
    - `useEffect` from react (add to existing useState, useMemo import)
    - `Eye, EyeOff` from lucide-react (add to existing Building2, Loader2 import -- and Check if Phase 02 added it)

    **New state variables (add after existing state declarations):**
    - `const [showPassword, setShowPassword] = useState(false);`
    - `const [showConfirmPassword, setShowConfirmPassword] = useState(false);`

    **Modify the main password input field:**
    The existing password `<div className="space-y-2">` section needs to wrap the Input in a `relative` container with the toggle button.

    Replace the password Input structure with:
    ```tsx
    <div className="relative">
      <Input
        id="password"
        type={showPassword ? "text" : "password"}
        placeholder="••••••••"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        autoComplete={mode === 'signup' ? "new-password" : "current-password"}
        required
        minLength={8}
        dir="ltr"
        className="text-left pl-10"
        onFocus={() => mode === 'signup' && setShowChecklist(true)}
      />
      <button
        type="button"
        onClick={() => setShowPassword(!showPassword)}
        className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
        aria-label={showPassword ? "הסתר סיסמה" : "הצג סיסמה"}
        tabIndex={-1}
      >
        {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
      </button>
    </div>
    ```

    Note: `pl-10` makes room for the icon on the left side (this is an LTR input in RTL layout, so left is correct for the icon). The `onFocus` handler was added by Phase 02 for the checklist -- preserve it.

    **Modify the confirmation password input field (signup mode only):**
    Phase 02 added a confirmation field. Wrap its Input in a similar `relative` container:
    ```tsx
    <div className="relative">
      <Input
        id="confirmPassword"
        type={showConfirmPassword ? "text" : "password"}
        placeholder="••••••••"
        value={confirmPassword}
        onChange={(e) => setConfirmPassword(e.target.value)}
        autoComplete="new-password"
        required
        dir="ltr"
        className="text-left pl-10"
      />
      <button
        type="button"
        onClick={() => setShowConfirmPassword(!showConfirmPassword)}
        className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors"
        aria-label={showConfirmPassword ? "הסתר סיסמה" : "הצג סיסמה"}
        tabIndex={-1}
      >
        {showConfirmPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
      </button>
    </div>
    ```

    **IMPORTANT notes on the Phase 02 state of AuthForm.tsx:**
    - Phase 02 added `confirmPassword`, `showChecklist` state variables
    - Phase 02 added `validation` useMemo, `passwordsMatch` useMemo, `isSubmitDisabled` computed value
    - Phase 02 added `PasswordStrengthIndicator` component render after password input
    - Phase 02 added confirmation field with match/mismatch feedback below it
    - Phase 02 changed submit button to `disabled={isSubmitDisabled}`
    - Phase 02 added `setConfirmPassword(''); setShowChecklist(false);` in the mode toggle onClick
    - All of these must be PRESERVED. Only add/modify what's described above.

    **DO NOT:**
    - Remove any Phase 02 code (PasswordStrengthIndicator, validation logic, confirmation field, submit gating)
    - Change the form's onSubmit handler
    - Add console.log statements
    - Remove the existing minLength={8} on the password input
    - Use right-side positioning for toggle icons (inputs are dir="ltr", icon goes on the left)
  </action>
  <verify>
    - `npx tsc --noEmit` compiles clean
    - `npx vitest run` -- all tests pass
    - AuthForm.tsx imports Eye, EyeOff from lucide-react
    - AuthForm.tsx has showPassword and showConfirmPassword state variables
    - Password input type uses ternary with showPassword
    - Confirm password input type uses ternary with showConfirmPassword
    - Both toggle buttons have Hebrew aria-labels
    - Both toggle buttons have tabIndex={-1}
  </verify>
  <done>
    Both password fields have Eye/EyeOff toggle buttons. Main password field toggles with showPassword state. Confirmation field toggles with showConfirmPassword state. Icons are positioned on the left (correct for LTR inputs in RTL layout). Hebrew aria-labels change based on visibility state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add autocomplete attributes and form clearing on mode switch</name>
  <files>src/components/auth/AuthForm.tsx</files>
  <action>
    Continue modifying AuthForm.tsx to add HTML5 autocomplete attributes to all form fields and implement form clearing when switching between signin/signup modes.

    **Add autocomplete attributes to existing inputs:**

    1. Full name input (signup mode): Add `autoComplete="name"`
    2. Email input: Add `autoComplete="username"` (NOT "email" -- "username" is the correct value for auth form email fields per MDN spec, enables password managers to associate credentials)
    3. Password input: Already added in Task 1 as `autoComplete={mode === 'signup' ? "new-password" : "current-password"}`
    4. Confirmation password input: Already added in Task 1 as `autoComplete="new-password"`

    **Add useEffect for form clearing on mode switch:**

    After the state declarations and computed values, add:
    ```tsx
    useEffect(() => {
      setEmail('');
      setPassword('');
      setFullName('');
      setConfirmPassword('');
      setShowChecklist(false);
      setShowPassword(false);
      setShowConfirmPassword(false);
    }, [mode]);
    ```

    This replaces the inline state resets that Phase 02 added to the mode toggle button's onClick. Update the mode toggle onClick to ONLY change the mode:
    ```tsx
    onClick={() => setMode(mode === 'signin' ? 'signup' : 'signin')}
    ```

    Remove the `setConfirmPassword(''); setShowChecklist(false);` from the onClick handler since the useEffect now handles ALL clearing when mode changes. This is cleaner because:
    - All clearing logic in one place (useEffect)
    - Handles any future state additions automatically
    - Mode is the single source of truth for the clearing trigger

    **Also clear any error state:** If there's an error state variable (toast errors are transient so they clear themselves), no additional work needed. Sonner toasts are fire-and-forget.

    **DO NOT:**
    - Use autocomplete="email" on the email field (use "username" for auth forms)
    - Use autocomplete="off" on any field (browsers ignore it, breaks password managers)
    - Add autocomplete to the form element itself
    - Change any other existing behavior
  </action>
  <verify>
    - `npx tsc --noEmit` compiles clean
    - `npx vitest run` -- all tests pass
    - `npm run build` -- production build succeeds
    - Full name input has autoComplete="name"
    - Email input has autoComplete="username"
    - Password input has autoComplete with mode-conditional value
    - Confirmation password has autoComplete="new-password"
    - useEffect with [mode] dependency clears all fields
    - Mode toggle onClick no longer has inline state resets (only setMode)
  </verify>
  <done>
    All 4 form fields have correct HTML5 autocomplete attributes. useEffect clears all fields (email, password, fullName, confirmPassword) plus resets UI state (showChecklist, showPassword, showConfirmPassword) when mode changes. Mode toggle button only calls setMode, with the useEffect handling all cleanup.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- TypeScript compiles clean
2. `npx vitest run` -- full test suite passes (no regressions)
3. `npm run build` -- production build succeeds
4. Manual check: AuthForm.tsx has Eye/EyeOff imports from lucide-react
5. Manual check: showPassword and showConfirmPassword state variables exist
6. Manual check: All 4 inputs have autoComplete attributes
7. Manual check: useEffect with [mode] dependency clears all form state
8. Grep confirm: `grep -c "autoComplete" src/components/auth/AuthForm.tsx` returns 4
</verification>

<success_criteria>
- Both password fields have working visibility toggle buttons with Eye/EyeOff icons
- Toggle buttons have Hebrew aria-labels ("הצג סיסמה" / "הסתר סיסמה")
- All form inputs have correct HTML5 autocomplete attributes (name, username, current-password/new-password)
- Switching between signin and signup clears all form fields and resets visibility toggles
- All Phase 02 features (validation, confirmation, submit gating, strength indicator) still work correctly
- All tests pass, TypeScript clean, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03-auth-ux-improvements/03-01-SUMMARY.md`
</output>
